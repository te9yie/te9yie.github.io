<!DOCTYPE html><html><head><title>te9yie</title><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="google-site-verification" content="iMWdKZ02K2Yzj9AtOP4cl-40F5DJp-YJLQDzv9vQgMk"/><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="te9yie.github.io"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/69d90237030765c6a2fa.css" as="style"/><link rel="stylesheet" href="/_next/static/css/69d90237030765c6a2fa.css" data-n-g=""/><link rel="preload" href="/_next/static/css/18a619bacb7468e88ab5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/18a619bacb7468e88ab5.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-1f0b73d383aed819e4f2.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.29f9e2f3d4a33bafbaa5.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.3a16fc34825ffc7ba561.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-83506c05f5dfa6040f9e.js" as="script"/><link rel="preload" href="/_next/static/chunks/7ac61503aba6d10b58e3c266d97d99b7b5b3721a.c1b518faff21babf1a9f.js" as="script"/><link rel="preload" href="/_next/static/chunks/5f8a2089eac11fe3b358516a6b612033195d4834.d21267665854b47491ea.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/index-9b12f7e5ac7c7e4e6afc.js" as="script"/></head><body><div id="__next"><header><nav><ul><li><a id="site-name" href="/"><h1>te9yie</h1></a></li><li><a href="/b">Blog</a></li><li><a href="/w">Wiki</a></li><li><a href="/search">Search</a></li></ul></nav></header><article><h2><a class="index_permalink__UOudO" href="/b/2021-03-04">2021-03-04</a></h2><p>RSSをつけてみたい。</p><p><a href="/w/Next.js">Next.js</a>でRSS生成ができるのか調べていた。見つけた方法は2つ。</p><ol><li><code>getServerSideProps()</code>を使ってSSRする。</li><li>ビルド時に別処理でRSSファイルを生成する。</li></ol><p>1.の方はサーバの用意が大変そうなのでやりたくない。2.になるんだけど、すでに<a href="/w/Next.js">Next.js</a>で同じような処理をやっているので、なんとかまとめたいと思っているんだけど、思いつかない。</p><p>RSS生成は<code>yarn export:rss</code>ってやると<code>./out/rss.xml</code>が出力される感じにしたい。できれば<a href="/w/TypeScript">TypeScript</a>で書きたいんだけど、コンパイルとかもろもろ面倒なので素の<a href="/w/JavaScript">JavaScript</a>で書くことにしてみる。それなら<code>node gen-rss.js</code>で済む。</p><pre><code class="language-package.json">&quot;scripts&quot;: {
  ...
  &quot;export:rss&quot;: &quot;node gen-rss.js&quot;,
  ...
},</code></pre><p>あとは<a href="/w/Next.js">Next.js</a>でもやったような、Markdownファイル群をHTMLに変換してRSSファイルを生成する――同じような処理を何度も書くの嫌だなあ。</p><p><a href="https://github.com/te9yie/te9yie.github.io/blob/main/gen-rss.js">https://github.com/te9yie/te9yie.github.io/blob/main/gen-rss.js</a></p><p><a href="https://ja.reactjs.org/docs/react-dom-server.html">ReactDOMServer</a>使ってComponentsを使い回せないかと思ったんだが、コンパイル後<code>.js</code>が散らばったり<code>tsconfig.json</code>をどこに置けば良いのか分からないやらで、今の自分の知識では厳しそうだった。</p><p>あとは<a href="/w/GitHub%20Actions">GitHub Actions</a>のワークフローに組み込んで完成。うまく動いているといいなあ。</p></article><article><h2><a class="index_permalink__UOudO" href="/b/2021-03-03">2021-03-03</a></h2><p>検索機能をつけたい。Google検索ができればよいと思い設定してみる。</p><p><a href="https://programmablesearchengine.google.com/">Programmable Search Engine</a></p><p>下記のコードをコピーして貼り付けてくれ、といわれたままやると<code>&lt;div&gt;</code>自体が見えなくなってうまく動かなかった。</p><pre><code class="language-html">&lt;script async src=&quot;https://cse.google.com/cse.js?cx=c961937a8b4f96e3d&quot;&gt;&lt;/script&gt;
&lt;div class=&quot;gcse-search&quot;&gt;&lt;/div&gt;</code></pre><p>まあ<a href="/w/React">React</a>だから<code>&lt;script&gt;</code>あたりの処理がうまく動かないのかなと思った。</p><p><code>useEffect</code>で対応してみた。</p><pre><code class="language-typescript">const SearchBox: React.FC = () =&gt; {
  const searchBoxRef = React.createRef&lt;HTMLDivElement&gt;();
  useEffect(() =&gt; {
    if (searchBoxRef &amp;&amp; searchBoxRef.current) {
      const searchBox = searchBoxRef.current;
      const parent = searchBox.parentNode;
      const gcse = document.createElement(&quot;script&quot;);
      gcse.async = true;
      gcse.src = &quot;https://cse.google.com/cse.js?cx=c961937a8b4f96e3d&quot;;
      parent?.insertBefore(gcse, searchBox);
    }
  });
  return (
    &lt;div className=&quot;search-box&quot;&gt;
      &lt;div ref={searchBoxRef} className=&quot;gcse-search&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
  );
};</code></pre><p>あと余白が大きくて邪魔だったのでCSSも書いた。</p><pre><code class="language-css">.gsc-control-cse {
    padding: 0 !important;
}</code></pre></article><article><h2><a class="index_permalink__UOudO" href="/b/2021-03-02">2021-03-02</a></h2><p>引き続き<a href="/w/JavaScript">JavaScript</a>の勉強。</p><p><a href="https://jsprimer.net/basic/function-this/">関数とthis · JavaScript Primer #jsprimer</a>を読んだ。</p><p>アロー関数では<code>this</code>は静的スコープで解決され、それ以外の関数では暗黙の引数で<code>this</code>が渡されるようだ。<code>var</code>の変数の巻き上げ挙動も怖い。知らないと色々罠がありそうだ。</p><p><a href="/w/TypeScript">TypeScript</a>を学ぶにしても、基本のJavaScriptの知識がないとダメなことが分かった。</p><hr/><p>開発環境として<a href="/w/Docker">Docker</a>を使ってみることにした。<a href="/w/VS%20Code">VS Code</a>から簡単に扱えるようなので試している。</p><p><a href="https://code.visualstudio.com/docs/remote/containers">Developing inside a Container using Visual Studio Code Remote Development</a></p><p>Windowsで<code>git clone</code>してRemote Containerで開いたらファイルが軒並み変更がかかった。どうも改行コードらへんの扱いが怪しいらしい。と思ったら、そのものの解説があった。</p><p><a href="https://code.visualstudio.com/docs/remote/troubleshooting#_resolving-git-line-ending-issues-in-containers-resulting-in-many-modified-files">Visual Studio Code Remote Development Troubleshooting Tips and Tricks</a></p><p><code>.gitattributes</code>を追加することにした。</p><pre><code class="language-gitattributes">* text=auto eol=lf</code></pre><hr/><p>いや、Windows上で<code>git clone</code>せずに<a href="/w/WSL">WSL</a>上でやって、そこからRemove Containerを使うと大丈夫だ。</p></article><footer>© <!-- -->2021<!-- --> <!-- -->te9yie</footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":[{"id":"2021-03-04","content":"RSSをつけてみたい。\n\n[[Next.js]]でRSS生成ができるのか調べていた。見つけた方法は2つ。\n\n1. `getServerSideProps()`を使ってSSRする。\n2. ビルド時に別処理でRSSファイルを生成する。\n\n1.の方はサーバの用意が大変そうなのでやりたくない。2.になるんだけど、すでに[[Next.js]]で同じような処理をやっているので、なんとかまとめたいと思っているんだけど、思いつかない。\n\nRSS生成は`yarn export:rss`ってやると`./out/rss.xml`が出力される感じにしたい。できれば[[TypeScript]]で書きたいんだけど、コンパイルとかもろもろ面倒なので素の[[JavaScript]]で書くことにしてみる。それなら`node gen-rss.js`で済む。\n\n```package.json\n\"scripts\": {\n  ...\n  \"export:rss\": \"node gen-rss.js\",\n  ...\n},\n```\n\nあとは[[Next.js]]でもやったような、Markdownファイル群をHTMLに変換してRSSファイルを生成する――同じような処理を何度も書くの嫌だなあ。\n\nhttps://github.com/te9yie/te9yie.github.io/blob/main/gen-rss.js\n\n[ReactDOMServer](https://ja.reactjs.org/docs/react-dom-server.html)使ってComponentsを使い回せないかと思ったんだが、コンパイル後`.js`が散らばったり`tsconfig.json`をどこに置けば良いのか分からないやらで、今の自分の知識では厳しそうだった。\n\nあとは[[GitHub Actions]]のワークフローに組み込んで完成。うまく動いているといいなあ。\n"},{"id":"2021-03-03","content":"検索機能をつけたい。Google検索ができればよいと思い設定してみる。\n\n[Programmable Search Engine](https://programmablesearchengine.google.com/)\n\n下記のコードをコピーして貼り付けてくれ、といわれたままやると`\u003cdiv\u003e`自体が見えなくなってうまく動かなかった。\n\n```html\n\u003cscript async src=\"https://cse.google.com/cse.js?cx=c961937a8b4f96e3d\"\u003e\u003c/script\u003e\n\u003cdiv class=\"gcse-search\"\u003e\u003c/div\u003e\n```\n\nまあ[[React]]だから`\u003cscript\u003e`あたりの処理がうまく動かないのかなと思った。\n\n`useEffect`で対応してみた。\n\n```typescript\nconst SearchBox: React.FC = () =\u003e {\n  const searchBoxRef = React.createRef\u003cHTMLDivElement\u003e();\n  useEffect(() =\u003e {\n    if (searchBoxRef \u0026\u0026 searchBoxRef.current) {\n      const searchBox = searchBoxRef.current;\n      const parent = searchBox.parentNode;\n      const gcse = document.createElement(\"script\");\n      gcse.async = true;\n      gcse.src = \"https://cse.google.com/cse.js?cx=c961937a8b4f96e3d\";\n      parent?.insertBefore(gcse, searchBox);\n    }\n  });\n  return (\n    \u003cdiv className=\"search-box\"\u003e\n      \u003cdiv ref={searchBoxRef} className=\"gcse-search\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n  );\n};\n```\n\nあと余白が大きくて邪魔だったのでCSSも書いた。\n\n```css\n.gsc-control-cse {\n    padding: 0 !important;\n}\n```\n"},{"id":"2021-03-02","content":"引き続き[[JavaScript]]の勉強。\n\n[関数とthis · JavaScript Primer #jsprimer](https://jsprimer.net/basic/function-this/)を読んだ。\n\nアロー関数では`this`は静的スコープで解決され、それ以外の関数では暗黙の引数で`this`が渡されるようだ。`var`の変数の巻き上げ挙動も怖い。知らないと色々罠がありそうだ。\n\n[[TypeScript]]を学ぶにしても、基本のJavaScriptの知識がないとダメなことが分かった。\n\n---\n\n開発環境として[[Docker]]を使ってみることにした。[[VS Code]]から簡単に扱えるようなので試している。\n\n[Developing inside a Container using Visual Studio Code Remote Development](https://code.visualstudio.com/docs/remote/containers)\n\nWindowsで`git clone`してRemote Containerで開いたらファイルが軒並み変更がかかった。どうも改行コードらへんの扱いが怪しいらしい。と思ったら、そのものの解説があった。\n\n[Visual Studio Code Remote Development Troubleshooting Tips and Tricks](https://code.visualstudio.com/docs/remote/troubleshooting#_resolving-git-line-ending-issues-in-containers-resulting-in-many-modified-files)\n\n`.gitattributes`を追加することにした。\n\n```gitattributes\n* text=auto eol=lf\n```\n\n---\n\nいや、Windows上で`git clone`せずに[[WSL]]上でやって、そこからRemove Containerを使うと大丈夫だ。\n"}]},"__N_SSG":true},"page":"/","query":{},"buildId":"ZeafxrTmA-95HNLHL4z4M","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-4f4acd756cef4fe6da1b.js"></script><script src="/_next/static/chunks/main-1f0b73d383aed819e4f2.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.29f9e2f3d4a33bafbaa5.js" async=""></script><script src="/_next/static/chunks/commons.3a16fc34825ffc7ba561.js" async=""></script><script src="/_next/static/chunks/pages/_app-83506c05f5dfa6040f9e.js" async=""></script><script src="/_next/static/chunks/7ac61503aba6d10b58e3c266d97d99b7b5b3721a.c1b518faff21babf1a9f.js" async=""></script><script src="/_next/static/chunks/5f8a2089eac11fe3b358516a6b612033195d4834.d21267665854b47491ea.js" async=""></script><script src="/_next/static/chunks/pages/index-9b12f7e5ac7c7e4e6afc.js" async=""></script><script src="/_next/static/ZeafxrTmA-95HNLHL4z4M/_buildManifest.js" async=""></script><script src="/_next/static/ZeafxrTmA-95HNLHL4z4M/_ssgManifest.js" async=""></script></body></html>